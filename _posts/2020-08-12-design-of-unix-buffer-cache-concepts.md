---
layout: post
title:  "unix操作系统设计-第三章高速缓存概念笔记"
date:   2020-08-12 19:59:00 +0700
categories: [unix]
---

## 学习目标
学习unix中缓存系统的概念

## 核心词汇
LRU:最近最少使用.
hash和链表
延迟写

## 概念解释
#### 为磁盘块分配缓冲区-getblk
![[缓冲池示意图.png]]
算法目标:我们想要读取磁盘中的数据,但是数据必须先读到内核缓冲区内,我们要找一个free的缓冲区给其使用,所以这是一个分配给某个磁盘块free缓冲区的算法.
约束:一个磁盘块对应的缓冲区只可以有一个.
getblk算法概述:
- 第一种情况:当要找的缓冲区对应的散列表中且该缓冲区是free的,那么标记该缓冲区为busy,并且从free list中移除.
- 第二种情况:当要找的缓冲区不在散列表中,那么从free list中取一个分配,放到其所属的散列表中.
- 第三种情况:当要找的缓冲区不在散列表中,并且试图从free list中分配时,发现其被打上了延迟写的标记,那么必须先将其写入对应的块并且重新开始算法.
- 第四种情况:当要找的缓冲区不在散列表中,且free list是空的.等待有free的缓冲区.
- 第五种情况:当要找的缓冲区对应的散列表中且该缓冲区是busy的,等待其free.并且重新开始算法.

LRU:注意每次分配buffer都是从头部分配,而每次release buffer都是放在尾部(除了某些特殊情况,比如延迟写),所以当buffer不断从尾部接近头部的时候意味着它一直没有被使用,而在其前面更接近头部的是比他更早被使用的.


#### 读取磁盘数据-bread
算法概述:
1. 先使用getblk算法获取到缓冲区
2. 读取数据到缓冲区中
3. 返回带有数据的缓冲区

#### 将缓冲区数据写到磁盘上-bwrite
1. 同步写
2. 释放缓冲区,放到free list的尾部





